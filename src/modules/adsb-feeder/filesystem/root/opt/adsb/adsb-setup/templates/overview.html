{% extends "base.html" %}
{% set active_page = "overview" %}
{# TODO add warning boxes, see the index page #}
{# TODO hostname #}
{# TODO internal vs external ip #}
{# TODO mdns status and reachable domains #}
{# TODO hotspot enabled? #}
{# TODO nameserver #}
{# TODO internet access? #}
{# TODO ais/adsb reception (msgs/min) #}
{# TODO network interfaces #}
{# TODO remote access (tailscale, autossh) #}
{# TODO if in hotspot mode, show this here #}
{% block content %}
  <h1 class="mt-3 text-center text-danger">
    {% block title %}Overview{% endblock title %}
  </h1>
  <ul>
    <li>
      <span style="display: inline-block; width: 6em;"><strong>Feeder version:</strong></span> {{ version }}
    </li>
    <li>
      <span style="display: inline-block; width: 6em;"><strong>Board:</strong></span> {{ board }}
    </li>
    <li>
      <span style="display: inline-block; width: 6em;"><strong>Base:</strong></span> {{ base }}
    </li>
    {# <li><span style="display: inline-block; width: 6em;"><strong>DNS:</strong></span>
    {% if env_value_by_tag('dns_state') %} DNS appears to be working{% else %} The feeder cannot resolve DNS queries
    {% endif %}
  </li>
  <li id="ip-mismatch" class="d-none"><span style="display: inline-block; width: 6em;"><strong>IP:</strong></span>
    Your browser and the feeder have different external IP addresses.
  </li>
  <li id="ip-match" class="d-none"><span style="display: inline-block; width: 6em;"><strong>Network/IP:</strong></span>
    Your browser and the feeder have the same external IP address.
  </li> #}
    <li>
      <strong>Containers:</strong>
      <ul>
        {% for container in containers %}<li>{{ container }}</li>{% endfor %}
      </ul>
    </li>
    <li>
      <strong>SDR(s):</strong>
      {# TODO short informative, what are they used for currently? #}
      {% if sdrs %}
        <ul>
          {% for sdr in sdrs %}
            <li>
              <pre>{{ sdr }}</pre>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        no SDRs connected
      {% endif %}
    </li>
  </ul>
  {# <script>
  let browser_ip = null;
  let feeder_ip = null;
  function compareIps() {
    if (feeder_ip == null || browser_ip == null) {
      return;
    }
    if (browser_ip != feeder_ip) {
      console.log("IP check: browser got", browser_ip, "feeder has", feeder_ip);
      $("#ip-mismatch").removeClass("d-none")
    } else {
      $("#ip-match").removeClass("d-none")
    }
  }
  fetch("https://api.ipify.org?format=json", { signal: AbortSignal.timeout(15000) })
    .then(response => response.json())
    .then(data => {
      browser_ip = data["ip"];
      compareIps();
    });
  fetch("/api/ip_info", { signal: AbortSignal.timeout(15000) })
    .then(response => response.json())
    .then(data => {
      feeder_ip = data["feeder_ip"];
      compareIps();
    });
  </script> #}
{% endblock content %}
